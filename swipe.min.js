function Swipe(a){function b(){if(!a&&(a={}),!a.dom)throw new Error("缺少参数！");var b=a.dom;f=b.getElementsByClassName("swipeBody")[0],g=f.children,h=f.style,a.startIndex=a.startIndex?a.startIndex-1:0,a.defaultStartIndex=0,a.defaultEndIndex=g.length-1,a.swipeTime=a.swipeTime||500,m.e=a,m.currentIndex=0,m.swiping=!1,m.transitions=!1,m.swipeLimitedSize=a.swipeLimitedSize||p,m.touch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,function(a){for(var b=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"],c=document.createElement("div"),d=0,e=b.length;e>d;d++)if(c.style[b[d]]!==a){m.transitions=!0;break}}()}function c(){if(b(),m.e.continues&&g.length>2){var a=g[g.length-1],c=g[0];f.appendChild(c.cloneNode(!0)),f.insertBefore(a.cloneNode(!0),c),g=f.children,m.e.defaultStartIndex+=1,m.e.startIndex+=1,m.e.defaultEndIndex+=1}m.childrenLength=g.length,q.eventHandlers.bindInitedEvent()}function d(a){if(!(0>a||!m.e.continues&&a>=m.childrenLength)){m.currentIndex;m.currentIndex=a,m.swiping=!0;var b=m.e.floowSwipe?k.time-i.time:0,c=m.e.swipeTime-b;c=c<m.e.swipeTime/3?m.e.swipeTime/3:c,m.transitions?q.setTransitionYMove(-a*window.innerHeight+"px",c):q.animate.stop().run(parseFloat(h.top)||0,-a*window.innerHeight,c,q.eventHandlers.swipeEnd)}}function e(a,b){console.log(a),0>a||!m.e.continues&&a>=m.childrenLength||(m.currentIndex=a,q.resetIndex(),m.isResetIndex&&console.log(m.isResetIndex,m.currentIndex),m.transitions?q.setTransitionYMove(-m.currentIndex*window.innerHeight+"px",0):q.animate.stop().run(parseFloat(h.top)||0,-m.currentIndex*window.innerHeight,0),m.swiping=!1,setTimeout(function(){b&&b()},0))}var f,g,h,i,j,k,l,m=this,n=1,o=-1,p=100,q={setTransitionYMove:function(a,b){h.webkitTransitionDuration=h.MozTransitionDuration=h.msTransitionDuration=h.OTransitionDuration=h.transitionDuration=b+"ms",h.webkitTransform="translate(0, "+a+")translateZ(0)",h.msTransform=h.MozTransform=h.OTransform="translateY("+a+")"},resetIndex:function(){switch(m.currentIndex){case m.childrenLength-1:m.currentIndex=m.e.defaultStartIndex,m.isResetIndex=!0;break;case 0:m.currentIndex=m.e.defaultEndIndex,m.isResetIndex=!0;break;default:m.isResetIndex=!1}return m.isResetIndex},getEventPos:function(a,b){return m.touch?{x:b?a.changedTouches[0].pageX||a.changedTouches[0].clientX:a.touches[0].pageX||a.touches[0].pageY,y:b?a.changedTouches[0].pageY||a.changedTouches[0].clientY:a.touches[0].pageY||a.touches[0].clientY}:{x:a.pageX||a.clientX,y:a.pageY||a.clientY}},animate:{run:function(a,b,c,d){if(!c)return void(h.top=b+"px");var e=+new Date;l=setInterval(function(){var f=+new Date-e;return f>c?(h.top=b+"px",d&&d(),void clearInterval(l)):void(h.top=(b-a)*(Math.floor(f/c*100)/100)+a+"px")},4)},stop:function(){return clearInterval(l),this}},eventHandlers:{bindInitedEvent:function(){m.transitions&&(f.addEventListener("webkitTransitionEnd",q.eventHandlers.swipeEnd,!1),f.addEventListener("msTransitionEnd",q.eventHandlers.swipeEnd,!1),f.addEventListener("oTransitionEnd",q.eventHandlers.swipeEnd,!1),f.addEventListener("otransitionend",q.eventHandlers.swipeEnd,!1),f.addEventListener("transitionend",q.eventHandlers.swipeEnd,!1)),m.touch?m.e.dom.addEventListener("touchstart",q.eventHandlers.touchStart,!1):m.e.dom.addEventListener("mousedown",q.eventHandlers.touchStart,!1)},bindOtherEvents:function(){m.touch?(m.e.dom.addEventListener("touchmove",q.eventHandlers.touchMove,!1),m.e.dom.addEventListener("touchend",q.eventHandlers.touchEnd,!1)):(m.e.dom.addEventListener("mousemove",q.eventHandlers.touchMove,!1),m.e.dom.addEventListener("mouseup",q.eventHandlers.touchEnd,!1))},unbindOtherEvents:function(){m.touch?(m.e.dom.removeEventListener("touchmove",q.eventHandlers.touchMove,!1),m.e.dom.removeEventListener("touchend",q.eventHandlers.touchEnd,!1)):(m.e.dom.removeEventListener("mousemove",q.eventHandlers.touchMove,!1),m.e.dom.removeEventListener("mouseup",q.eventHandlers.touchEnd,!1))},swipeEnd:function(){m.swiping=!1,q.resetIndex(),m.e.continues&&m.isResetIndex&&(m.transitions?q.setTransitionYMove(-m.currentIndex*window.innerHeight+"px",0):h.top=-m.currentIndex*window.innerHeight+"px"),m.e.onSwipeEnd&&m.e.onSwipeEnd.call(g[m.currentIndex])},touchStart:function(a){i=q.getEventPos(a),i.time=+new Date,q.eventHandlers.bindOtherEvents()},touchMove:function(a){if(a.preventDefault&&a.preventDefault(),!m.e.floowSwipe)return k={time:0},!0;k=q.getEventPos(a),k.time=+new Date;var b=-m.currentIndex*window.innerHeight+k.y-i.y;m.transitions?q.setTransitionYMove(b+"px",0):q.animate.stop().run(-m.currentIndex*window.innerHeight,b,0)},touchEnd:function(a){return j=q.getEventPos(a,!0),Math.abs(j.y-i.y)<m.swipeLimitedSize?void(m.transitions?q.setTransitionYMove(-m.currentIndex*window.innerHeight+"px",m.e.swipeTime/2):q.animate.stop().run(parseFloat(h.top),-m.currentIndex*window.innerHeight,0)):(q.eventHandlers.swipeHandler(j.y>i.y?o:n),void q.eventHandlers.unbindOtherEvents())},swipeHandler:function(a){if(!m.swipeHandlerExecing){if(m.swipeHandlerExecing=!0,m.swiping)return m.e.swipeWhenSwiping?void e(m.currentIndex,function(){d(m.currentIndex+a),m.swipeHandlerExecing=!1}):void(m.swipeHandlerExecing=!1);if(m.e.onSwipeStart&&!m.e.onSwipeStart())return void(m.swipeHandlerExecing=!1);d(m.currentIndex+a),m.swipeHandlerExecing=!1}}}};return c(),e(m.e.startIndex),this.Helper=q,this}
